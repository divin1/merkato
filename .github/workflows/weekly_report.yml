name: Merkato: Weekly Report

on:
  schedule:
    # Run every Thursday morning at 8 AM UTC
    - cron: '0 8 * * 4'
  workflow_dispatch:  # Allow manual trigger

jobs:
  check-stocks:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Install uv
      uses: astral-sh/setup-uv@v4
      with:
        version: "latest"
        
    - name: Set up Python
      run: uv python install
        
    - name: Install dependencies
      run: uv sync
        
    - name: Run Weekly Report
      env:
        EMAIL_SENDER: ${{ secrets.EMAIL_SENDER }}
        EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
        EMAIL_RECIPIENT: ${{ secrets.EMAIL_RECIPIENT }}
        EMAIL_SMTP_SERVER: ${{ secrets.EMAIL_SMTP_SERVER }}
        EMAIL_SMTP_PORT: ${{ secrets.EMAIL_SMTP_PORT }}
      run: |
        uv run weekly-report
